{% extends "base.html" %}

{% block title %}{{ code }} è‚¡ç¥¨åˆ†æ{% endblock %}

{% block content %}
<div class="page-header">
    {% if data %}
    <h2>ğŸ“ˆ ä¸ªè‚¡æ·±åº¦åˆ†æ - {{ data.name }} ({{ code }})</h2>
    {% else %}
    <h2>ğŸ“ˆ ä¸ªè‚¡æ·±åº¦åˆ†æ - {{ code }}</h2>
    {% endif %}
    <p class="subtitle"><a href="/">â† è¿”å›é¦–é¡µ</a></p>
</div>

{% if error %}
<div class="content-wrapper">
    <div class="error-message">
        <h3>âš ï¸ åˆ†æå¤±è´¥</h3>
        <p>{{ error }}</p>
    </div>
</div>
{% elif data %}
<div class="content-wrapper">
    <!-- è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯ -->
    <div class="card">
        <h3>ğŸ“Š {{ data.name }} ({{ data.code }})</h3>

        <!-- ä»Šæ—¥è¡Œæƒ… -->
        <div class="section">
            <h4>ğŸ’¹ ä»Šæ—¥è¡Œæƒ…</h4>
            <table class="data-table">
                <tr>
                    <th>æ˜¨æ—¥æ”¶ç›˜</th>
                    <td>Â¥{{ "%.2f"|format(data.yesterday_close) }}</td>
                    <th>ä»Šæ—¥å¼€ç›˜</th>
                    <td>Â¥{{ "%.2f"|format(data.today_open) }}</td>
                </tr>
                <tr>
                    <th>ä»Šæ—¥æœ€é«˜</th>
                    <td>Â¥{{ "%.2f"|format(data.today_high) }}</td>
                    <th>ä»Šæ—¥æœ€ä½</th>
                    <td>Â¥{{ "%.2f"|format(data.today_low) }}</td>
                </tr>
                <tr>
                    <th>ä»Šæ—¥æ”¶ç›˜</th>
                    <td>Â¥{{ "%.2f"|format(data.today_close) }}</td>
                    <th>æ¶¨è·Œå¹…</th>
                    <td class="{% if data.change_pct > 0 %}positive{% else %}negative{% endif %}">
                        {{ "%+.2f"|format(data.change_pct) }}%
                    </td>
                </tr>
                <tr>
                    <th>æŒ¯å¹…</th>
                    <td>{{ "%.2f"|format(data.amplitude) }}%</td>
                    <th>é‡æ¯”</th>
                    <td>{{ "%.2f"|format(data.volume_ratio) }}x</td>
                </tr>
                <tr>
                    <th>æˆäº¤é‡</th>
                    <td colspan="3">{{ "{:,.0f}".format(data.today_volume) }} æ‰‹</td>
                </tr>
            </table>
        </div>

        <!-- æŠ€æœ¯æŒ‡æ ‡ -->
        <div class="section">
            <h4>ğŸ“ˆ æŠ€æœ¯æŒ‡æ ‡</h4>
            <table class="data-table">
                <tr>
                    <th>MA5</th>
                    <td>Â¥{{ "%.2f"|format(data.ma5) }}
                        {% if data.today_close > data.ma5 %}âœ…{% else %}âŒ{% endif %}
                    </td>
                    <th>MA10</th>
                    <td>Â¥{{ "%.2f"|format(data.ma10) }}
                        {% if data.today_close > data.ma10 %}âœ…{% else %}âŒ{% endif %}
                    </td>
                </tr>
                <tr>
                    <th>MA20</th>
                    <td>Â¥{{ "%.2f"|format(data.ma20) }}
                        {% if data.today_close > data.ma20 %}âœ…{% else %}âŒ{% endif %}
                    </td>
                    <th>å‡çº¿æ’åˆ—</th>
                    <td>
                        {% if data.ma5 > data.ma10 and data.ma10 > data.ma20 %}
                        âœ… å¤šå¤´æ’åˆ—
                        {% else %}
                        âš ï¸ éå¤šå¤´æ’åˆ—
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>

        <!-- AIæ·±åº¦åˆ†æ -->
        <div class="ai-analysis-box">
            <h4>ğŸ¤– AIæ·±åº¦åˆ†æ</h4>
            <p>{{ data.ai_analysis }}</p>
        </div>
    </div>
</div>
{% else %}
<div class="content-wrapper">
    <p>æ­£åœ¨åŠ è½½æ•°æ®...</p>
</div>
{% endif %}

<style>
    .section {
        margin: 2rem 0;
    }

    .section h4 {
        margin-bottom: 1rem;
        color: var(--primary-color);
        font-size: 1.2rem;
    }

    .error-message {
        background: #fee;
        border-left: 4px solid #c33;
        padding: 1.5rem;
        border-radius: 0.5rem;
    }

    .error-message h3 {
        margin-bottom: 0.5rem;
        color: #c33;
    }
</style>
{% endblock %}